<div>
  <section style="margin-bottom: 20px">
    <p-progressBar
      class="ui-progressbar-label ng-star-inserted"
      [value]="porcentagemTotal"
    ></p-progressBar>
  </section>

  <div class="row justify-content-between align-items-center">
    <div class="col-3 px-0">
      <div class="row">
        <div class="col-4">
          <div class="ui-g ui-fluid pl-3">
            <div class="ui-inputgroup">
              <button
                class="btn btn-sm btn-warning mb-1 ml-1"
                (click)="showFilters = true"
                pTooltip="Clique para filtrar"
                tooltipPosition="right"
              >
                <i
                  class="fa fa-filter"
                  style="color: #212529"
                  title="Filtrar dados"
                ></i>
              </button>
              <button
                (click)="exportDataToXlsx()"
                class="btn btn-sm btn-outline-dark mb-1 mx-1"
              >
                <i class="fa fa-file-excel" title="Exportar para Excel"></i>
              </button>
            </div>
          </div>
        </div>
        <div class="col px-0">
          <div class="p-inputgroup">
            <span class="p-inputgroup-addon"><i class="pi pi-search"></i></span
            ><input
              (input)="applyFilter($event)"
              type="text"
              pinputtext
              placeholder="Buscar"
              class="p-inputtext p-component p-element ng-pristine ng-valid ng-touched"
            />
          </div>
        </div>
      </div>
    </div>
    <div class="col-5">
      <div class="ui-g ui-fluid pl-3" style="text-align: center">
        <label for="infos">
          Total de empresas: {{ totalEmpresas }} - Total de trabalhadores:
          {{ totalTrabalhadores }}
        </label>
      </div>
    </div>
    <div class="col-4">
      <div class="display-inline-block float-right">
        <!-- <button class="btn btn-sm btn-warning mb-1 ml-1" (click)="consultaDominio()" tooltipPosition="left"> -->
        <p-inputMask
          [(ngModel)]="searchComp"
          [style]="{ 'margin-bottom': '8px' }"
          mask="99/9999"
          placeholder="Mês/Ano"
        ></p-inputMask>
        <button
          (click)="setCompetencia()"
          class="btn btn-sm btn-warning mb-1 mx-1"
          style="color: #212529"
          tooltipPosition="left"
        >
          Pesquisar Comp.
        </button>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col">
        <div class="card flex justify-content-center"></div>
      </div>
    </div>

    <div class="row">
      <!-- Código -->
      <div class="col-12 col-md-6 col-lg-4 relative mb-3">
        <div class="icon-select">
          <svg
            width="17"
            height="17"
            viewBox="0 0 17 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M13.216 2.08C12.84 2.024 12.408 2 11.8 2H4.6C4 2 3.56 2.024 3.208 2.072C0.528 2.368 0 3.96 0 6.6V11.4C0 14.04 0.528 15.632 3.184 15.92C3.56 15.976 3.992 16 4.6 16H11.8C12.4 16 12.84 15.976 13.192 15.928C15.872 15.632 16.4 14.048 16.4 11.4V6.6C16.4 3.96 15.872 2.368 13.216 2.08ZM6.672 6.6C7.12 6.6 7.48 6.96 7.48 7.4C7.48 7.84 7.12 8.2 6.68 8.2C6.24 8.2 5.88 7.84 5.88 7.4C5.88 6.96 6.232 6.6 6.672 6.6ZM4.272 6.6C4.728 6.6 5.08 6.96 5.08 7.4C5.08 7.84 4.72 8.2 4.28 8.2C3.84 8.2 3.48 7.84 3.48 7.4C3.48 6.96 3.832 6.6 4.272 6.6ZM12.2 12.4H4.216C3.888 12.4 3.608 12.128 3.608 11.8C3.608 11.472 3.872 11.2 4.2 11.2H12.2C12.528 11.2 12.8 11.472 12.8 11.8C12.8 12.128 12.528 12.4 12.2 12.4ZM12.2 8H9.4C9.072 8 8.8 7.728 8.8 7.4C8.8 7.072 9.072 6.8 9.4 6.8H12.2C12.528 6.8 12.8 7.072 12.8 7.4C12.8 7.728 12.528 8 12.2 8Z"
              fill="#FFC926"
            />
          </svg>
        </div>
        <p-multiSelect
          defaultLabel="Código"
          styleClass="border-transparent"
          [options]="codes"
          [(ngModel)]="selectedCodes"
          optionLabel="code"
        ></p-multiSelect>
      </div>

      <!-- Grupo -->
      <div class="col-12 col-md-6 col-lg-4 relative mb-3">
        <div class="icon-select">
          <svg
            width="17"
            height="17"
            viewBox="0 0 17 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              opacity="0.4"
              d="M13.6297 5.3195C13.5773 5.31201 13.5249 5.31201 13.4725 5.3195C12.3122 5.28207 11.3914 4.33133 11.3914 3.16349C11.3914 1.9732 12.3571 1 13.5548 1C14.7451 1 15.7183 1.96571 15.7183 3.16349C15.7109 4.33133 14.7901 5.28207 13.6297 5.3195Z"
              fill="#FFC926"
            />
            <path
              opacity="0.4"
              d="M16.0705 10.5073C15.2321 11.0688 14.0568 11.2784 12.9713 11.1362C13.2557 10.5223 13.4055 9.84105 13.4129 9.12238C13.4129 8.37377 13.2483 7.66259 12.9338 7.04124C14.0418 6.89153 15.2171 7.10113 16.063 7.66259C17.2458 8.44114 17.2459 9.72127 16.0705 10.5073Z"
              fill="#FFC926"
            />
            <path
              opacity="0.4"
              d="M5.32862 5.3195C5.38102 5.31201 5.43343 5.31201 5.48583 5.3195C6.64618 5.28207 7.56697 4.33133 7.56697 3.16349C7.56697 1.9732 6.60126 1 5.40348 1C4.21319 1 3.23999 1.96571 3.23999 3.16349C3.24748 4.33133 4.16827 5.28207 5.32862 5.3195Z"
              fill="#FFC926"
            />
            <path
              opacity="0.4"
              d="M5.40993 9.12253C5.40993 9.84868 5.56714 10.5374 5.85161 11.1588C4.79607 11.271 3.69561 11.0465 2.88711 10.5149C1.7043 9.72891 1.7043 8.44878 2.88711 7.66273C3.68812 7.12373 4.81853 6.90663 5.88156 7.02641C5.57463 7.65525 5.40993 8.36643 5.40993 9.12253Z"
              fill="#FFC926"
            />
            <path
              d="M9.58101 11.3833C9.52112 11.3758 9.45375 11.3758 9.38637 11.3833C8.00892 11.3383 6.90845 10.2079 6.90845 8.81552C6.90845 7.39315 8.05384 6.24029 9.48369 6.24029C10.9061 6.24029 12.0589 7.39315 12.0589 8.81552C12.0589 10.2079 10.9659 11.3383 9.58101 11.3833Z"
              fill="#FFC926"
            />
            <path
              d="M7.1481 12.9328C6.01769 13.6889 6.01769 14.9316 7.1481 15.6802C8.43573 16.5411 10.5468 16.5411 11.8344 15.6802C12.9648 14.9241 12.9648 13.6814 11.8344 12.9328C10.5543 12.0719 8.44321 12.0719 7.1481 12.9328Z"
              fill="#FFC926"
            />
          </svg>
        </div>
        <p-multiSelect
          defaultLabel="Grupo"
          styleClass="border-transparent"
          [options]="codes"
          [(ngModel)]="selectedCodes"
          optionLabel="code"
        ></p-multiSelect>
      </div>

      <!-- Empresas -->
      <div class="col-12 col-md-6 col-lg-4 relative mb-3">
        <div class="icon-select">
          <svg
            width="16"
            height="16"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M14.9255 4.07406C14.2608 3.33901 13.1504 2.97148 11.5396 2.97148H11.3519V2.9402C11.3519 1.6265 11.3519 0 8.41172 0H7.22312C4.28293 0 4.28293 1.63432 4.28293 2.9402V2.9793H4.09526C2.47658 2.9793 1.374 3.34683 0.70933 4.08188C-0.0648191 4.94204 -0.0413602 6.09936 0.0368368 6.88912L0.0446564 6.94386L0.105228 7.57984C0.116379 7.69697 0.17946 7.80278 0.277902 7.86721C0.465418 7.9899 0.779262 8.1922 0.96738 8.29667C1.07686 8.36704 1.19415 8.4296 1.31145 8.49216C2.64861 9.22721 4.11872 9.71985 5.61228 9.96226C5.68265 10.6973 6.00326 11.5575 7.71577 11.5575C9.42828 11.5575 9.76452 10.7051 9.81926 9.94662C11.4145 9.68857 12.955 9.13337 14.3469 8.32013C14.3938 8.29667 14.4251 8.27321 14.4642 8.24975C14.7744 8.07443 15.0962 7.85837 15.3896 7.64677C15.478 7.58296 15.5345 7.48444 15.5466 7.37613L15.5589 7.26447L15.598 6.89694C15.6058 6.85002 15.6058 6.81093 15.6137 6.75619C15.6762 5.96642 15.6606 4.88731 14.9255 4.07406ZM8.66977 9.43052C8.66977 10.2594 8.66977 10.3845 7.70795 10.3845C6.74612 10.3845 6.74612 10.236 6.74612 9.43834V8.45306H8.66977V9.43052ZM5.40114 2.97148V2.9402C5.40114 1.61086 5.40114 1.11822 7.22312 1.11822H8.41172C10.2337 1.11822 10.2337 1.61868 10.2337 2.9402V2.9793H5.40114V2.97148Z"
              fill="#FFC926"
            />
            <path
              d="M14.7553 9.35655C15.0318 9.22494 15.3503 9.44413 15.3226 9.7491L15.0419 12.8408C14.8777 14.4048 14.2364 16 10.7958 16H4.8372C1.39654 16 0.755325 14.4048 0.591111 12.8487L0.324687 9.918C0.297286 9.61655 0.608479 9.3976 0.884225 9.5224C1.77522 9.92551 3.41981 10.6407 4.43572 10.9068C4.5642 10.9404 4.66812 11.0324 4.72438 11.1527C5.19901 12.1678 6.22842 12.7079 7.71482 12.7079C9.18664 12.7079 10.229 12.147 10.7052 11.1294C10.7615 11.009 10.8656 10.917 10.9942 10.8833C12.0729 10.5994 13.8234 9.79992 14.7553 9.35655Z"
              fill="#FFC926"
            />
          </svg>
        </div>
        <p-multiSelect
          defaultLabel="Empresas"
          styleClass="border-transparent"
          [options]="codes"
          [(ngModel)]="selectedCodes"
          optionLabel="code"
        ></p-multiSelect>
      </div>

      <!-- CNPJ -->
      <div class="col-12 col-md-6 col-lg-4 relative mb-3">
        <div class="icon-select">
          <svg
            width="17"
            height="16"
            viewBox="0 0 17 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M13.6 0H3.4C1.5215 0 0 1.513 0 3.3745V11.9255C0 13.787 1.5215 15.3 3.4 15.3H13.6C15.4785 15.3 17 13.787 17 11.9255V3.3745C17 1.513 15.4785 0 13.6 0ZM5.525 3.5445C6.6045 3.5445 7.4885 4.4285 7.4885 5.508C7.4885 6.5875 6.6045 7.4715 5.525 7.4715C4.4455 7.4715 3.5615 6.5875 3.5615 5.508C3.5615 4.4285 4.4455 3.5445 5.525 3.5445ZM8.8145 11.611C8.738 11.696 8.619 11.747 8.5 11.747H2.55C2.431 11.747 2.312 11.696 2.2355 11.611C2.159 11.526 2.1165 11.407 2.125 11.288C2.2695 9.86 3.4085 8.7295 4.8365 8.5935C5.287 8.551 5.7545 8.551 6.205 8.5935C7.633 8.7295 8.7805 9.86 8.9165 11.288C8.9335 11.407 8.891 11.526 8.8145 11.611ZM14.45 11.6875H12.75C12.4015 11.6875 12.1125 11.3985 12.1125 11.05C12.1125 10.7015 12.4015 10.4125 12.75 10.4125H14.45C14.7985 10.4125 15.0875 10.7015 15.0875 11.05C15.0875 11.3985 14.7985 11.6875 14.45 11.6875ZM14.45 8.2875H11.05C10.7015 8.2875 10.4125 7.9985 10.4125 7.65C10.4125 7.3015 10.7015 7.0125 11.05 7.0125H14.45C14.7985 7.0125 15.0875 7.3015 15.0875 7.65C15.0875 7.9985 14.7985 8.2875 14.45 8.2875ZM14.45 4.8875H10.2C9.8515 4.8875 9.5625 4.5985 9.5625 4.25C9.5625 3.9015 9.8515 3.6125 10.2 3.6125H14.45C14.7985 3.6125 15.0875 3.9015 15.0875 4.25C15.0875 4.5985 14.7985 4.8875 14.45 4.8875Z"
              fill="#FFC926"
            />
          </svg>
        </div>
        <p-multiSelect
          defaultLabel="CNPJ"
          styleClass="border-transparent"
          [options]="codes"
          [(ngModel)]="selectedCodes"
          optionLabel="code"
        ></p-multiSelect>
      </div>

      <!-- Município -->
      <div class="col-12 col-md-6 col-lg-4 relative mb-3">
        <div class="icon-select">
          <svg
            width="14"
            height="16"
            viewBox="0 0 14 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              opacity="0.4"
              d="M13.4782 5.16024C12.6695 1.60199 9.56567 0 6.83922 0C6.83922 0 6.83922 0 6.83151 0C4.11278 0 1.00122 1.59428 0.19253 5.15254C-0.708588 9.1267 1.7252 12.4924 3.92793 14.6104C4.74433 15.396 5.79176 15.7888 6.83922 15.7888C7.88667 15.7888 8.93412 15.396 9.74282 14.6104C11.9455 12.4924 14.3793 9.1344 13.4782 5.16024Z"
              fill="#FFC926"
            />
            <path
              d="M6.83965 9.01902C8.17954 9.01902 9.26574 7.93283 9.26574 6.59294C9.26574 5.25302 8.17954 4.16682 6.83965 4.16682C5.49976 4.16682 4.41357 5.25302 4.41357 6.59294C4.41357 7.93283 5.49976 9.01902 6.83965 9.01902Z"
              fill="#FFC926"
            />
          </svg>
        </div>
        <p-multiSelect
          defaultLabel="Município"
          styleClass="border-transparent"
          [options]="codes"
          [(ngModel)]="selectedCodes"
          optionLabel="code"
        ></p-multiSelect>
      </div>

      <!-- Estado -->
      <div class="col-12 col-md-6 col-lg-4 relative mb-3">
        <div class="icon-select">
          <svg
            width="15"
            height="17"
            viewBox="0 0 15 17"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M14.4744 5.2615C13.6498 1.63342 10.4851 0 7.70514 0C7.70514 0 7.70514 0 7.69729 0C4.92516 0 1.75256 1.62557 0.927997 5.25364C0.00919825 9.30578 2.49074 12.7375 4.73669 14.8971C5.56911 15.6981 6.63714 16.0986 7.70514 16.0986C8.77315 16.0986 9.84115 15.6981 10.6657 14.8971C12.9117 12.7375 15.3932 9.31363 14.4744 5.2615ZM7.70514 9.19584C6.33872 9.19584 5.23143 8.08857 5.23143 6.72215C5.23143 5.35573 6.33872 4.24846 7.70514 4.24846C9.07156 4.24846 10.1788 5.35573 10.1788 6.72215C10.1788 8.08857 9.07156 9.19584 7.70514 9.19584Z"
              fill="#FFC926"
            />
          </svg>
        </div>
        <p-multiSelect
          defaultLabel="Estado"
          styleClass="border-transparent"
          [options]="codes"
          [(ngModel)]="selectedCodes"
          optionLabel="code"
        ></p-multiSelect>
      </div>
    </div>

    <div class="row">
      <div class="col">
        <div class="card flex justify-content-center"></div>
      </div>
    </div>
  </div>

  <p-table
    *ngIf="visibleTable"
    [loading]="loading"
    [globalFilterFields]="[
      'cod_empresa',
      'razao_social',
      'cnpj',
      'nome_responsavel',
      'nome_cordenador'
    ]"
    #dt
    [value]="dataListagem"
    [paginator]="true"
    [rows]="15"
    dataKey="cod_empresa"
  >
    <ng-template pTemplate="header" let-columns>
      <tr>
        <th rowspan="2" class="th_c">Código</th>
        <th rowspan="2">Empresa</th>
        <th rowspan="2">Grupo</th>
        <th rowspan="2">Razão social</th>
        <th rowspan="2">CNPJ</th>
        <th rowspan="2">Observação</th>
      </tr>
    </ng-template>
    <ng-template
      pTemplate="body"
      let-rowData
      let-objeto
      let-expanded="expanded"
      let-columns="columns"
    >
      <tr>
        <td>
          <a href="#" [pRowToggler]="rowData">
            <i [ngClass]="expanded ? 'fa fa-minus' : 'fa fa-plus'"></i>
          </a>
        </td>

        <td style="display: none" pSortableColumn="id_responsavel" class="td_l">
          {{ objeto.id_responsavel }}
        </td>
        <td pSortableColumn="cod_empresa" class="td_l">
          {{ objeto.cod_empresa }}
        </td>
        <td pSortableColumn="razao_social" class="td_l">
          {{ objeto.razao_social }}
        </td>
        <td pSortableColumn="cnpj" class="td_l">{{ objeto.cnpj }}</td>
        <td pSortableColumn="nome_responsavel" class="td_l">
          {{ objeto.nome_responsavel }}
        </td>
        <td pSortableColumn="nome_cordenador" class="td_l">
          {{ objeto.nome_cordenador }}
        </td>
        <td style="text-align: center" class="td_l">
          <p-progressBar [value]="objeto.percent_concluido"></p-progressBar>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="rowexpansion" let-rowDataItem let-columns="columns">
      <tr>
        <td colspan="7">
          <div class="col-sm-12 p-3">
            <div style="margin-bottom: 1%" class="p-inputgroup">
              <span
                style="
                  height: 39px !important;
                  color: white !important;
                  background-color: #ffc107 !important;
                  border-color: #ffc107 !important;
                "
                (click)="exportDataToEmpregadosXlsx(rowDataItem.empregados)"
                class="p-inputgroup-addon btn btn-sm btn-outline-dark mx-1"
              >
                <i class="fa fa-file-excel"></i></span
              ><span class="p-inputgroup-addon">
                <i class="pi pi-search"></i
              ></span>
              <input
                (input)="
                  dtinside.filterGlobal(getEventValue($event), 'contains')
                "
                type="text"
                pinputtext=""
                placeholder="Buscar"
                class="p-inputtext p-component p-element ng-pristine ng-valid ng-touched"
              />
            </div>
            <p-table
              #dtinside
              [value]="rowDataItem.empregados"
              dataKey="cod_empregado"
              [globalFilterFields]="[
                'cod_empregado',
                'nome_empregado',
                'data_evento',
                'status_validado',
                'tipo_evento'
              ]"
            >
              <ng-template pTemplate="header">
                <tr>
                  <th pSortableColumn="cod_empregado">
                    Cod. do empregado<p-sortIcon field="price"></p-sortIcon>
                  </th>
                  <th pSortableColumn="nome_empregado">
                    Nome <p-sortIcon field="customer"></p-sortIcon>
                  </th>
                  <th pSortableColumn="inicio_contrato">
                    Inicio contrato<p-sortIcon field="date"></p-sortIcon>
                  </th>
                  <th pSortableColumn="data_transmissao">
                    Data Transmissão<p-sortIcon field="amount"></p-sortIcon>
                  </th>
                  <th pSortableColumn="data_demissao">
                    Data Demissão<p-sortIcon field="amount"></p-sortIcon>
                  </th>
                  <th pSortableColumn="situacao">
                    Status<p-sortIcon field="status"></p-sortIcon>
                  </th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-empregado>
                <tr>
                  <td>{{ empregado.cod_empregado }}</td>
                  <td>
                    {{ empregado.nome_empregado }}
                  </td>
                  <td>{{ formatarData(empregado.inicio_contrato) }}</td>
                  <td>{{ formatarData(empregado.data_transmissao) }}</td>
                  <td>{{ formatarData(empregado.data_demissao) }}</td>
                  <td>{{ empregado.situacao }}</td>
                </tr>
              </ng-template>
              <ng-template pTemplate="emptymessage">
                <tr>
                  <td colspan="6">There are no order for this product yet.</td>
                </tr>
              </ng-template>
            </p-table>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage" let-listaCompleta>
      <tr>
        <td align="center">Não foram encontrados dados.</td>
      </tr>
    </ng-template>
  </p-table>

  <div *ngIf="!dataListagem">
    <p align="right">Nenhum registro encontrado.</p>
  </div>

  <section class="custom-filtro">
    <p-sidebar
      [style]="{ height: '100%', 'z-index': '10000' }"
      [(visible)]="showFilters"
      position="left"
      [baseZIndex]="10000"
      class="custom-filter"
    >
      <div class="row mx-2">
        <h4 style="padding-top: 0px; padding-bottom: 0px; margin-bottom: 0px">
          <i class="fa fa-filter mb-3"></i> Filtro
        </h4>
      </div>
      <div class="mt-2 display-inline-block float-right">
        <button
          (click)="clearFilters()"
          onclick="document.getElementById('cod-input').value = ''"
          class="btn btn-outline-danger btn-sm float-right"
          style="margin: auto !important"
        >
          <i class="fa fa-eraser"></i> Limpar
        </button>
      </div>

      <div>
        <br />
        <span class="ui-label">
          <label for="_codigo">Código: </label>
          <br />
          <input
            id="cod-input"
            [(ngModel)]="codString"
            (input)="addFilter($event, 'cod_empresa')"
            type="number"
            size="15"
            pInputText
          />
        </span>
        <br />
        <span class="ui-label">
          <label for="Empresa">Empresa: </label><br />
          <p-multiSelect
            [style]="{ width: '100%' }"
            [ngModelOptions]="{ standalone: true }"
            [(ngModel)]="empSelecionada"
            (onChange)="addFilter($event, 'razao_social')"
            [options]="filterEmpresa"
            optionLabel="name"
            defaultLabel="Empresa"
          ></p-multiSelect>
        </span>

        <br />
        <span class="ui-label">
          <label for="Empresa">Responsável: </label><br />
          <p-multiSelect
            [(ngModel)]="respSelecionado"
            [ngModelOptions]="{ standalone: true }"
            (onChange)="addFilter($event, 'id_responsavel')"
            [options]="usuariosExecutoresRh"
            optionLabel="name"
            [style]="{ width: '100%' }"
            defaultLabel="Responsável"
          ></p-multiSelect>
        </span>

        <br />
        <span class="ui-label">
          <label for="Empresa">Coordenador: </label><br />
          <p-multiSelect
            [(ngModel)]="cordSelecionado"
            [ngModelOptions]="{ standalone: true }"
            (onChange)="addFilter($event, 'id_cordenador')"
            optionLabel="name"
            [options]="usuariosCordenadoresRh"
            [style]="{ width: '100%' }"
            defaultLabel="Coordenador"
          ></p-multiSelect>
        </span>
        <br />
        <span class="ui-label">
          <label for="Empresa">Status: </label><br />
          <p-dropdown
            [style]="{ width: '100%' }"
            [ngModelOptions]="{ standalone: true }"
            (onChange)="filterTransferidos($event)"
            [(ngModel)]="status"
            [options]="statusEmpresas"
            defaultLabel="label"
          ></p-dropdown>
        </span>
      </div>
    </p-sidebar>
  </section>
</div>
